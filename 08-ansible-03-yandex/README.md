# Домашнее задание к занятию "08.03 Использование Yandex Cloud"

## Подготовка к выполнению
1. Создайте свой собственный (или используйте старый) публичный репозиторий на github с произвольным именем.
2. Скачайте [playbook](./playbook/) из репозитория с домашним заданием и перенесите его в свой репозиторий.

## Основная часть
1. Допишите playbook: нужно сделать ещё один play, который устанавливает и настраивает kibana.
2. При создании tasks рекомендую использовать модули: `get_url`, `template`, `yum`, `apt`.
3. Tasks должны: скачать нужной версии дистрибутив, выполнить распаковку в выбранную директорию, сгенерировать конфигурацию с параметрами.
4. Приготовьте свой собственный inventory файл `prod.yml`.
```commandline
---
all:
  hosts:
    el-instance:
      ansible_host: 84.201.158.104
    ki-instance:
      ansible_host: 84.252.130.20
    f-instance:
      ansible_host: 62.84.115.182
  vars:
    ansible_connection: ssh
    ansible_user: mikhail
elasticsearch:
  hosts:
    el-instance:
kibana:
  hosts:
    ki-instance:
filebeat:
  hosts:
    f-instance:
```
5. Запустите `ansible-lint site.yml` и исправьте ошибки, если они есть.
6. Попробуйте запустить playbook на этом окружении с флагом `--check`.
7. Запустите playbook на `prod.yml` окружении с флагом `--diff`. Убедитесь, что изменения на системе произведены.
8. Повторно запустите playbook с флагом `--diff` и убедитесь, что playbook идемпотентен.
```commandline
Убеждаемся, что playbook идемпотентен

Mikhails-MacBook-Pro:playbook mikhailrusakovich$ ansible-playbook -i inventory/prod site.yml --diff

PLAY [Install Elasticsearch] **************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************
ok: [el-instance]

TASK [Download Elasticsearch's rpm] *******************************************************************************************************************************************
ok: [el-instance]

TASK [Install Elasticsearch] **************************************************************************************************************************************************
ok: [el-instance]

TASK [Configure Elasticsearch] ************************************************************************************************************************************************
ok: [el-instance]

PLAY [Install Kibana] *********************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************
ok: [ki-instance]

TASK [Download kibana's rpm] **************************************************************************************************************************************************
ok: [ki-instance]

TASK [Install Kibana] *********************************************************************************************************************************************************
ok: [ki-instance]

TASK [Configure Kibana] *******************************************************************************************************************************************************
ok: [ki-instance]

PLAY [Install Filebeat] *******************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************
ok: [f-instance]

TASK [Download filebeat's rpm] ************************************************************************************************************************************************
ok: [f-instance]

TASK [Install Filebeat] *******************************************************************************************************************************************************
ok: [f-instance]

TASK [Configure filebeat] *****************************************************************************************************************************************************
ok: [f-instance]

TASK [Set filebeat systemwork] ************************************************************************************************************************************************
changed: [f-instance]

TASK [Load Kibana dashboard] **************************************************************************************************************************************************
ok: [f-instance]

PLAY RECAP ********************************************************************************************************************************************************************
el-instance                : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
f-instance                 : ok=6    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ki-instance                : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   


```
9. Проделайте шаги с 1 до 8 для создания ещё одного play, который устанавливает и настраивает filebeat.
```commandline
Mikhails-MacBook-Pro:playbook mikhailrusakovich$ ansible-playbook -i inventory/prod site.yml 

PLAY [Install Elasticsearch] **************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************
ok: [el-instance]

TASK [Download Elasticsearch's rpm] *******************************************************************************************************************************************
ok: [el-instance]

TASK [Install Elasticsearch] **************************************************************************************************************************************************
ok: [el-instance]

TASK [Configure Elasticsearch] ************************************************************************************************************************************************
ok: [el-instance]

PLAY [Install Kibana] *********************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************
ok: [ki-instance]

TASK [Download kibana's rpm] **************************************************************************************************************************************************
ok: [ki-instance]

TASK [Install Kibana] *********************************************************************************************************************************************************
ok: [ki-instance]

TASK [Configure Kibana] *******************************************************************************************************************************************************
ok: [ki-instance]

PLAY [Install Filebeat] *******************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************
ok: [f-instance]

TASK [Download filebeat's rpm] ************************************************************************************************************************************************
ok: [f-instance]

TASK [Install Filebeat] *******************************************************************************************************************************************************
ok: [f-instance]

TASK [Configure filebeat] *****************************************************************************************************************************************************
changed: [f-instance]

TASK [Set filebeat systemwork] ************************************************************************************************************************************************
changed: [f-instance]

TASK [Load Kibana dashboard] **************************************************************************************************************************************************
ok: [f-instance]

RUNNING HANDLER [restart filebeat] ********************************************************************************************************************************************
changed: [f-instance]

PLAY RECAP ********************************************************************************************************************************************************************
el-instance                : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
f-instance                 : ok=7    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ki-instance                : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

```
---
10. Подготовьте README.md файл по своему playbook. В нём должно быть описано: что делает playbook, какие у него есть параметры и теги.
11. Готовый playbook выложите в свой репозиторий, в ответ предоставьте ссылку на него.</br>

Установка и выполнение tasks прошла успешно.

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
